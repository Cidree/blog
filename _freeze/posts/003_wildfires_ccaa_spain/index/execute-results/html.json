{
  "hash": "579b449c443c95ce8de95777c89f61b5",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Spanish Wildfires by CCAA during 2006-2015\"\ndate: \"2023-11-18\"\ncategories: [R, forestry, wildfires, ggplot2]\nimage: \"image.png\"\n# Execution \nexecute: \n  warning: false\n---\n\n\n> # Spanish Wildfires by Autonomous Communities\n\n## Introduction\n\nIn this post, we will explore the distribution of the forest wildfires in Spain by Autonomous Community, creating some descriptive graphs using R and `ggplot2`.\n\nThe data was obtained from the MITECO (Ministerio para la Transición Ecológica y el Reto Demográfico), and it can be found in this [link](https://www.miteco.gob.es/es/biodiversidad/servicios/banco-datos-naturaleza/informacion-disponible/incendios-forestales.html).\n\nI will use the data for the decade 2005-2015, which is the latest available database for this purpose.\n\n## Loading packages\n\nFirst, we will load some packages:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(pacman)\n\np_load(\n  ## Core\n  tidyverse, readxl, stringi,\n  \n  ## Vectorial data manipulation\n  sf,\n  \n  ## Download data\n  mapSpain,\n  \n  ## Visualization\n  RColorBrewer\n)\n```\n:::\n\n\nHere, I will use the `tidyverse` as usual for data analysis and visualization, the package `readxl` since the data is in *Excel* format, and `stringi` for some string manipulation. Then, the package `sf` for vectorial data manipulation, `mapSpain` to download the map of Spain by any NUTS level. Finally, I will use `RColorBrewer` for colour palettes.\n\n## Data exploration\n\nOnce the packages are loaded, we can load the data. Note that the data is on the $3^{rd}$ sheet of the *Excel* file. The variables are in Spanish, so I will change some names to English so we can all understand what's going on.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## Load the data\nwildfires_tbl <- read_excel(\"wildfires_2006_2015.xlsx\", sheet = 3) \n\n## Set new names\nwildfires_tbl <- wildfires_tbl %>% \n  select(municipality = NOMBRE, ccaa = COM_N_INE, small_fires = conatos, wildfires = incendios, \n         total_wildires = TOTAL_INCENDIOS, woodland_area = ARBOLADO, \n         treeless_area = NOARBOLADO, total_area = TOTAL)\n\n## Overview of the data\nglimpse(wildfires_tbl)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 4,376\nColumns: 8\n$ municipality   <chr> \"A Arnoia\", \"A Baña\", \"A Bola\", \"A Cañiza\", \"A Capela\",…\n$ ccaa           <chr> \"Galicia\", \"Galicia\", \"Galicia\", \"Galicia\", \"Galicia\", …\n$ small_fires    <dbl> 27, 66, 74, 330, 12, 149, 156, 75, 33, 426, 30, 58, 86,…\n$ wildfires      <dbl> 3, 37, 12, 81, 6, 24, 54, 47, 4, 273, 3, 62, 28, 16, 28…\n$ total_wildires <dbl> 30, 103, 86, 411, 18, 173, 210, 122, 37, 699, 33, 120, …\n$ woodland_area  <dbl> 30, 615, 16, 978, 394, 18, 262, 600, 8, 803, 30, 364, 6…\n$ treeless_area  <dbl> 8, 82, 61, 1260, 165, 104, 791, 641, 17, 3395, 6, 1558,…\n$ total_area     <dbl> 38, 697, 77, 2238, 559, 122, 1053, 1241, 25, 4198, 36, …\n```\n\n\n:::\n:::\n\n\nSo we can see that there is data about the number of wildfires, and the area burned. This week we will study the number of wildfires and the next week we will have a look to the area burned and their relationship.\n\nThere are a total of 4,376 observations, where each observation stands for a single municipality (therefore, the column municipality can be thought as the ID). Then, we have the Autonomous Community (*ccaa*) to which the municipality belongs, the number of fires, and the burned area. To those who are not familiarized with the concept of \"*conato*\", which I translated as small fire, this is:\n\n> **Conato**: wildfires where the total burned area is less than 1 hectare. This definition applies to the data here; however, in some Autonomous Communities the definition may be different. For instance, in Galicia they consider that less than 0.5 hectares must be woodland area, otherwise, it is categorized as normal wildfire.\n\nThere is also another category called *Grandes Incendios Forestales* (Large Forest Fires), which are those that burn more than 500 hectares. However, they did not consider this category in the data.\n\n::: callout-note\n## Note\n\nIf you are interested, the first two sheets of the Excel file contain some metadata and information about the variables.\n:::\n\n## Analysing the number of wildfires\n\nLet's do some data wrangling! Since we will analyse the wildfires by Autonomous Community, we need to summarise our data using the *ccaa* variable. So this can be easily done as follows:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwildfires_ccaa_tbl <- wildfires_tbl %>% \n  group_by(ccaa) %>% \n  summarise(\n    total_wildfires = sum(total_wildires)\n  ) %>% \n  ungroup()\n\nwildfires_ccaa_tbl\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 17 × 2\n   ccaa                       total_wildfires\n   <chr>                                <dbl>\n 1 Andalucia                             7519\n 2 Aragon                                3055\n 3 Canarias                               954\n 4 Cantabria                             6257\n 5 Castilla y Leon                      16421\n 6 Castilla-La Mancha                    6725\n 7 Cataluña                              3751\n 8 Comunidad Foral de Navarra            4577\n 9 Comunidad de Madrid                   2657\n10 Comunitat Valenciana                  3349\n11 Extremadura                           8148\n12 Galicia                              37870\n13 Illes Balears                         1031\n14 La Rioja                               634\n15 Pais Vasco                             913\n16 Principado de Asturias               16979\n17 Region de Murcia                      1157\n```\n\n\n:::\n:::\n\n\nCool. This starts to look pretty good, but we need to apply some formatting. First, we can order the Autonomous Communities by descending order of the total wildfires, and create a label with the percentages format.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwildfires_ccaa_total_tbl <- wildfires_ccaa_tbl %>% \n  mutate(\n    ccaa       = fct_reorder(ccaa, total_wildfires),\n    label_perc = scales::percent(total_wildfires / sum(total_wildfires),\n                                 accuracy = .01)\n    ) %>% \n  arrange(desc(total_wildfires))\n\nwildfires_ccaa_total_tbl\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 17 × 3\n   ccaa                       total_wildfires label_perc\n   <fct>                                <dbl> <chr>     \n 1 Galicia                              37870 31.04%    \n 2 Principado de Asturias               16979 13.92%    \n 3 Castilla y Leon                      16421 13.46%    \n 4 Extremadura                           8148 6.68%     \n 5 Andalucia                             7519 6.16%     \n 6 Castilla-La Mancha                    6725 5.51%     \n 7 Cantabria                             6257 5.13%     \n 8 Comunidad Foral de Navarra            4577 3.75%     \n 9 Cataluña                              3751 3.07%     \n10 Comunitat Valenciana                  3349 2.75%     \n11 Aragon                                3055 2.50%     \n12 Comunidad de Madrid                   2657 2.18%     \n13 Region de Murcia                      1157 0.95%     \n14 Illes Balears                         1031 0.85%     \n15 Canarias                               954 0.78%     \n16 Pais Vasco                             913 0.75%     \n17 La Rioja                               634 0.52%     \n```\n\n\n:::\n:::\n\n\nNow this looks much better! With the function `scales::percent` we can do the trick to create a character column with the percentage of wildfires over the total, and with the argument `accuracy` we specify the decimals. The `fct_reorder` function is used to order the levels of the Autonomous Communities (which is necessary for visualize in this order).\n\nNow that we have the data ready, we can create a cool visualization to explore the data better:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwildfires_ccaa_total_tbl  %>% \n  head(10) %>% \n  ggplot(aes(x = ccaa, y = total_wildfires)) +\n  geom_col(fill = \"steelblue\") +\n  geom_label(aes(label = label_perc)) +\n  coord_flip() +\n  expand_limits(y = 40000) +\n  labs(x        = NULL,\n       y        = \"Total Wildfires\",\n       title    = \"Wildfires by Autonomous Community (2006-2015)\",\n       subtitle = \"Top 10 Autonomous Communities in Spain\",\n       caption  = \"Author: Adrián Cidre González\") +\n  annotate(\n    \"rect\", xmin = 7.5, xmax = 10.5, ymin = -500, ymax = 41000,\n    fill = NA, color = \"indianred4\", lwd = 1\n  ) +\n  annotate(\n    \"text\",\n    x = 8.5, y = 30000, \n    label = \"The northwest of Spain \\nsuffers the 58% of \\nthe wildfires\",\n    color = \"indianred4\"\n  ) +\n  theme_minimal() +\n  theme(plot.title = element_text(hjust = 0.5),\n        plot.subtitle = element_text(hjust = 0.5))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\nOk, that was quite a bit of code. First, we can see that I filtered the top 10 Autonomous Communities with `head`. Then, we have a bar plot with the label that we previously created. The `expand_limits` function expands the axis so the label of Galicia can be seen properly. Next, the `annotate` functions create the rectangle and the label on the text. Note that we need to specify the geom of the annotation (in these cases *rect* and *text*). The rest of the arguments are just formatting. Isn't it cool? That's why I love `ggplot2` ❤️.\n\n### Analysing the results\n\nThere is an Autonomous Community were the number of fires are extremely high, Galicia. Almost one third of the Spanish burned area during the decade 2006-2015 was in this region, which in fact only occupies 5.8% of the territory of Spain. Next, we have Asturias with almost 14% of the total burned area, and occupying the 2.1% of the territory. To finish the top-3, we have Castilla and León where a similar area to Asturias was burned. However, Castilla and Leon is the biggest Autonomous Community of Spain representing the 18.6% of the territory. These numbers are alarming, and more when we look at the spatial location of these areas. The top-3 areas, representing the 58% of the burned area, are all located in the North-Western area of Spain.\n\n## Analysing the spatial distribution\n\nTo analyse the spatial distribution we need to get the vectorial data of the Autonomous Communities of Spain. One way is to use the package `mapSpain`:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nesp_ccaa_sf <- esp_get_ccaa() %>% \n  filter(!(iso2.ccaa.name.es %in% c(\"Melilla\", \"Ceuta\")))\n```\n:::\n\n\nWith that code I am eliminating Ceuta and Melilla, because they are not included in the wildfires dataset. The next step is to join the `esp_ccaa_sf` and `wildfires_ccaa_total_tbl`; however, there's an issue:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nesp_ccaa_sf$nuts2.name\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"Andalucía\"                  \"Aragón\"                    \n [3] \"Principado de Asturias\"     \"Illes Balears\"             \n [5] \"Canarias\"                   \"Cantabria\"                 \n [7] \"Castilla y León\"            \"Castilla-La Mancha\"        \n [9] \"Cataluña\"                   \"Comunidad Valenciana\"      \n[11] \"Extremadura\"                \"Galicia\"                   \n[13] \"Comunidad de Madrid\"        \"Región de Murcia\"          \n[15] \"Comunidad Foral de Navarra\" \"País Vasco\"                \n[17] \"La Rioja\"                  \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nwildfires_ccaa_total_tbl$ccaa\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] Galicia                    Principado de Asturias    \n [3] Castilla y Leon            Extremadura               \n [5] Andalucia                  Castilla-La Mancha        \n [7] Cantabria                  Comunidad Foral de Navarra\n [9] Cataluña                   Comunitat Valenciana      \n[11] Aragon                     Comunidad de Madrid       \n[13] Region de Murcia           Illes Balears             \n[15] Canarias                   Pais Vasco                \n[17] La Rioja                  \n17 Levels: La Rioja Pais Vasco Canarias Illes Balears ... Galicia\n```\n\n\n:::\n:::\n\n\nDo you see it? The names are different, so that might be a problem when we try to join them. In the wildfires dataset, they didn't use acute accent (e.g. á). We could manually change it, but the package `stringi` allows us to this more efficiently:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nesp_ccaa_sf %>% \n  mutate(nuts2.name = nuts2.name %>% stri_trans_general(\"Latin-ASCII\")) %>% \n  pull(nuts2.name)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"Andalucia\"                  \"Aragon\"                    \n [3] \"Principado de Asturias\"     \"Illes Balears\"             \n [5] \"Canarias\"                   \"Cantabria\"                 \n [7] \"Castilla y Leon\"            \"Castilla-La Mancha\"        \n [9] \"Cataluna\"                   \"Comunidad Valenciana\"      \n[11] \"Extremadura\"                \"Galicia\"                   \n[13] \"Comunidad de Madrid\"        \"Region de Murcia\"          \n[15] \"Comunidad Foral de Navarra\" \"Pais Vasco\"                \n[17] \"La Rioja\"                  \n```\n\n\n:::\n:::\n\n\nThat's a first approach, but now we need to manually change Calatuna to Cataluña, and also Comunidad Valenciana, which was previously already different. So all the changes will be achieved as follows:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n##\nwildfires_ccaa_sf <- esp_ccaa_sf %>% \n  mutate(nuts2.name = nuts2.name %>% stri_trans_general(\"Latin-ASCII\")) %>% \n  mutate(nuts2.name = case_when(\n    nuts2.name == \"Comunidad Valenciana\" ~ \"Comunitat Valenciana\",\n    nuts2.name == \"Cataluna\" ~ \"Cataluña\",\n    .default = nuts2.name\n  )) %>% \n  inner_join(\n    wildfires_ccaa_total_tbl,\n    by = join_by(nuts2.name == ccaa)\n  ) %>% \n  select(nuts2.name, total_wildfires)\n\nwildfires_ccaa_sf\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple feature collection with 17 features and 2 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: -13.21924 ymin: 34.70209 xmax: 4.320511 ymax: 43.78793\nGeodetic CRS:  ETRS89\nFirst 10 features:\n               nuts2.name total_wildfires                       geometry\n1               Andalucia            7519 MULTIPOLYGON (((-4.275964 3...\n2                  Aragon            3055 MULTIPOLYGON (((-0.74093 42...\n3  Principado de Asturias           16979 MULTIPOLYGON (((-4.536122 4...\n4           Illes Balears            1031 MULTIPOLYGON (((4.095952 40...\n5                Canarias             954 MULTIPOLYGON (((-8.504825 3...\n6               Cantabria            6257 MULTIPOLYGON (((-3.16291 43...\n7         Castilla y Leon           16421 MULTIPOLYGON (((-4.743011 4...\n8      Castilla-La Mancha            6725 MULTIPOLYGON (((-2.050606 4...\n9                Cataluña            3751 MULTIPOLYGON (((0.844002 42...\n10   Comunitat Valenciana            3349 MULTIPOLYGON (((0.689104 39...\n```\n\n\n:::\n:::\n\n\nThere, the `inner_join` function uses now the both columns to create a new table which the data together.\n\nUp to this point, we can improve the visualization by creating some breaks:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwildfires_ccaa_sf <- wildfires_ccaa_sf %>% \n  mutate(\n    total_wildfires = cut(\n      wildfires_ccaa_sf$total_wildfires, \n      breaks  = c(0, 1000, 3000, 5000, 10000, 20000, 40000),\n      dig.lab = 5\n    )\n  )\n```\n:::\n\n\nBy doing this, we split the continuous variable of number of wildfires in a discrete variable divided into bins. That can improve some visualizations when the values are very different, and specially to catch outliers.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(wildfires_ccaa_sf) +\n  geom_sf(aes(fill = total_wildfires)) +\n  scale_fill_brewer(palette = \"RdYlGn\", direction = -1) +\n  labs(\n    title    = \"Number of Wildfires by CCAA\",\n    subtitle = \"Period: 2006-2015\",\n    fill     = \"Wildfires\"\n  ) +\n  theme_bw() +\n  theme(plot.title = element_text(hjust = 0.5),\n        plot.subtitle = element_text(hjust = 0.5),\n        legend.position = \"bottom\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\n### Analysing the results\n\nWe can now confirm that the North-Western area of Spain suffers a significantly higher number of wildfires (\\>10.000) in comparison to other areas. In contrast, the Eastern area suffers a lesser number of fires, with the Vask Country and La Rioja as the Autonomous Communities which suffered the smallest number of wildfires during the period 2006-2015.\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}